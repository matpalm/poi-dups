
sql to dump table
select p.id as poi_id, pl.name as poi_name, places.name as place_name from pois p join places on p.place_id=places.id join poi_localisations pl on pl.poi_id=p.id
save as pois.csv


$ ./csv_to_tsv.rb < pois.csv > pois.tsv

total #entries 
$ wc -l pois.tsv
201,583

# freq of uniq name/place combos
$ cat pois.tsv | ./emit_name_place.rb | sort | uniq -c | perl -plne's/.*?(\d+ ).*/$1/' > uniq_counts
 192646 1 # ie only combo of name/place
   3245 2 # ie there are 3245 cases of 2 pois with same name/place
    436 3 
    213 4 
     30 5 
     14 6 
      3 7 
     ub 1 9 
bCfkk      1 8 
      1 15  # ??? 1 case where there are 15 pois with same name/place ?!?!

extract exact dups, keeping only one
$ cat pois.tsv | ./exact_dups.rb > pois.uniq.tsv 2> exact_dups.ids
$ wc -l pois.uniq.tsv
196,590
$ wc -l exact_dups.ids
3,944

run near duplicate detection (0.6)
$ cat pois.uniq.tsv | ./near_dups.rb > near_dups.out   
(similarity id1 id2)
0.666666666666667	  1 2
0.578947368421053	  1 3
0.657142857142857	  0 1
...
4323 lines (took 28m)

connected components
$ cat near_dups.out | ./connected_components.rb | sort -nr > connected_components.out
1.0 425823 425821
1.0 432060 431980
0.999 1067389 1067384
0.86 1107522 1107523 1107521 1107524 1105365
0.76 1070593 1098180
0.76 1122825 1122818
0.7 1100334 378607
...












